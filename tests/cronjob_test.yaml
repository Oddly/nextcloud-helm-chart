suite: cronjob tests
templates:
  - charts/app-template/templates/common.yaml
tests:
  - it: should create cron job
    asserts:
      - isKind:
          of: CronJob
        documentSelector:
          path: metadata.name
          value: nextcloud-cron

  - it: should run cron as www-data user (33)
    asserts:
      - equal:
          path: spec.jobTemplate.spec.template.spec.securityContext.runAsUser
          value: 33
        documentSelector:
          path: metadata.name
          value: nextcloud-cron

  - it: should run every 5 minutes by default
    asserts:
      - equal:
          path: spec.schedule
          value: "*/5 * * * *"
        documentSelector:
          path: metadata.name
          value: nextcloud-cron

  - it: should forbid concurrent cron runs
    asserts:
      - equal:
          path: spec.concurrencyPolicy
          value: Forbid
        documentSelector:
          path: metadata.name
          value: nextcloud-cron
